---
sidebar_label: Rector
---

# Rector - instant upgrades and automated refactoring

https://github.com/rectorphp/rector

> Rector instantly upgrades and refactors the PHP code of your application.

**Vortex** comes with [pre-configured Rector configuration](https://github.com/drevops/vortex/blob/main/rector.php)
for Drupal projects. The configuration is based on
the configuration provided
by [Drupal Rector](https://github.com/palantirnet/drupal-rector).

## What is Rector?

Rector automatically refactors your PHP and Drupal code to:

- **Fix deprecated Drupal APIs** - Prepares code for Drupal major version upgrades
- **Modernize PHP syntax** - Leverages PHP 8.3 language features
- **Improve code quality** - Enhances readability and maintainability
- **Reduce technical debt** - Automated cleanup and optimization

## When to use Rector

- **Before Drupal Upgrades**: Run before upgrading Drupal major versions to fix deprecations
- **During Development**: Run periodically (weekly/monthly) to catch deprecations early
- **Code Reviews**: Include in CI pipeline for automated quality checks
- **Refactoring Legacy Code**: When modernizing older codebases

:::note

  Rector is often used ad hoc to perform bulk refactoring.

  In **Vortex**, it is integrated as a regular code quality tool
  that can be run at any time to check for deprecated code and
  automatically fix issues. This allows us to keep the codebase up-to-date
  _continuously_ rather than waiting for major upgrades.

:::

## Usage

### Check for violations

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs>
  <TabItem value="ahoy" label="Ahoy" default>
    ```shell
    ahoy lint-be
    ```
  </TabItem>
  <TabItem value="docker-compose" label="Docker Compose">
    ```shell
    docker compose exec cli vendor/bin/rector --dry-run
    ```
  </TabItem>
</Tabs>

### Fix violations

<Tabs>
  <TabItem value="ahoy" label="Ahoy" default>
    ```shell
    ahoy lint-fix
    ```
  </TabItem>
  <TabItem value="docker-compose" label="Docker Compose">
    ```shell
    docker compose exec cli vendor/bin/rector process
    ```
  </TabItem>
</Tabs>

## Configuration

See [configuration reference](https://getrector.com/documentation).

All global configuration takes place in
the [`rector.php`](https://github.com/drevops/vortex/blob/main/rector.php)
file.

Targets include custom modules and themes, settings and tests.

### Config sets

Rector provides [config sets](https://getrector.com/documentation/set-lists)
functionality that allows to enable/disable rules in bulk.

**Vortex** provides the config sets for Drupal 8, 9 and 10 deprecated code and
code style fixes.

The config sets are meant to be adjusted per-project as needed.

A full list of available config sets can be found in
the [Rules overview](https://getrector.com/documentation/rules-overview) page.

## Ignoring

See more
on [Ignoring Rules Or Paths](https://getrector.com/documentation/ignoring-rules-or-paths)
page.

Ignoring rules **globally** takes place in
the [`rector.php`](https://github.com/drevops/vortex/blob/main/rector.php) file:

```php
->withSkip([
  SimplifyIfReturnBoolRector::class,
])
```

To ignore **all Rector rules** within a file:

```php
->withSkip([
  'file.php',
  '*/other_file.php',
])
```

To ignore **a specific rule** within a file:

```php
->withSkip([
  SimplifyIfReturnBoolRector::class => ['file.php'],
])
```

Rector does not support ignoring of the **code blocks**.

## Cache management

### How caching works

Rector caches parsed file information and analysis results to speed up subsequent runs:

- **Cache location**: `/tmp/_rector` (system temp directory)
- **Stores**: Parsed AST, file metadata, rule analysis results
- **Performance**: Subsequent runs are ~40-60% faster by reusing results for unchanged files

### When to clear cache

Clear Rector cache in these situations:

1. **After changing `rector.php` configuration**
   - Added/removed rules
   - Changed skip list
   - Modified paths

2. **After updating Rector or Drupal Rector packages**

   ```shell
   composer update rector/rector palantirnet/drupal-rector
   ```

3. **When seeing unexpected behavior**
   - Rules not applying when they should
   - Stale results
   - False negatives in CI

4. **After switching git branches** with different Rector configurations

### Clear cache

To clear cache and check for violations:

<Tabs>
  <TabItem value="ahoy" label="Ahoy" default>
    ```shell
    ahoy cli vendor/bin/rector process --clear-cache --dry-run
    ```
  </TabItem>
  <TabItem value="docker-compose" label="Docker Compose">
    ```shell
    docker compose exec cli vendor/bin/rector process --clear-cache --dry-run
    ```
  </TabItem>
</Tabs>

To clear cache and apply changes:

<Tabs>
  <TabItem value="ahoy" label="Ahoy" default>
    ```shell
    ahoy cli vendor/bin/rector process --clear-cache
    ```
  </TabItem>
  <TabItem value="docker-compose" label="Docker Compose">
    ```shell
    docker compose exec cli vendor/bin/rector process --clear-cache
    ```
  </TabItem>
</Tabs>

## Ignoring fail in continuous integration pipeline

This tool runs in continuous integration pipeline by default and fails the build
if there are any violations.

Set `VORTEX_CI_RECTOR_IGNORE_FAILURE` environment variable to `1` to ignore
failures. The tool will still run and report violations, if any.
