---
sidebar_label: Lagoon
sidebar_position: 4
---

# Lagoon deployment

Lagoon deployment triggers a deployment on the [Lagoon](https://lagoon.sh/)
hosting platform by calling its webhook URL.

## How it works

When `lagoon` is included in `$VORTEX_DEPLOY_TYPES`, the deployment script
calls the Lagoon webhook URL to trigger a deployment. Lagoon then:

1. Pulls the latest code from your repository
2. Builds container images using your `docker-compose.yml`
3. Deploys containers to Kubernetes
4. Runs post-rollout tasks defined in `.lagoon.yml`

## Configuration

### Environment variables

| Variable | Required | Default | Location | Description |
|----------|----------|---------|----------|-------------|
| `LAGOON_PROJECT` | **Yes** | | `.env` | Your Lagoon project name |
| `VORTEX_DEPLOY_LAGOON_INSTANCE` | No | `amazeeio` | `.env` | Lagoon instance name |
| `VORTEX_DEPLOY_LAGOON_INSTANCE_GRAPHQL` | No | Auto-generated | `.env` | Lagoon GraphQL endpoint |
| `VORTEX_DEPLOY_LAGOON_INSTANCE_HOSTNAME` | No | Auto-generated | `.env` | Lagoon SSH hostname |
| `VORTEX_DEPLOY_LAGOON_INSTANCE_PORT` | No | Auto-generated | `.env` | Lagoon SSH port |
| `VORTEX_DEPLOY_LAGOON_BRANCH` | No | Current branch | CI | Branch to deploy |

### Setup

1. Add `lagoon` to the `VORTEX_DEPLOY_TYPES` variable in your `.env` file:

   ```shell title=".env"
   VORTEX_DEPLOY_TYPES=lagoon
   ```

2. Configure your Lagoon project name:

   ```shell title=".env"
   LAGOON_PROJECT=your-project-name
   ```

3. Ensure your CI has the Lagoon SSH key configured for authentication.

## Post-deployment automation

When code is deployed, Vortex automatically:

1. **Provisions the site** - Runs database updates, imports configuration, clears caches
2. **Sends notifications** - Notifies configured channels about the deployment

This is implemented using post-rollout tasks defined in the
[`.lagoon.yml`](https://github.com/drevops/vortex/blob/main/.lagoon.yml)
configuration file.

## Environment types

Lagoon creates different environment types based on your branch:

| Branch pattern | Environment type |
|---------------|------------------|
| `main`, `master` | Production |
| `develop` | Development |
| `release/*`, `hotfix/*` | Staging |
| Pull requests | Development (ephemeral) |

## See also

- [Lagoon hosting](/docs/hosting/lagoon) - Detailed Lagoon hosting configuration
- [Lagoon documentation](https://docs.lagoon.sh/) - Official Lagoon docs
