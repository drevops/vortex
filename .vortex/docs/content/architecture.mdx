# Architecture

**Vortex** is a production-ready Drupal project template designed to simplify
onboarding, standardize processes, and ensure long-term maintainability.

This page provides a high-level overview of how the template is structured, how
its components work together, and how your project benefits from its
architecture.

## Design principles

**Vortex** is guided by principles that prioritize simplicity, visibility, and
maintainability:

- **Simple is better than complex**: The template encourages clarity, even in
  customizations.
- **Use standard tools**: Wherever possible, **Vortex** follows upstream conventions
  and avoids reinvention.
- **Avoid silent errors**: Misconfigurations should fail loudly.
- **Readability counts**: Code and configuration are meant to be understood.
- **Explicit logging helps**: Scripts log every major step, so it’s easy to
  follow what’s going on.

## System components

The system is made up of several modular pieces that work together:

- Local development environment
- Drupal management
- Code quality and testing tools
- Continuous integration workflows
- Hosting provider configurations
- Automated dependency updates
- Project documentation
- Automation scripts to connect components

You can see how these parts connect in the diagram below:

<picture style={{ display: 'block', textAlign: 'center' }}>
<img src="/img/diagram-dark.png#gh-dark-mode-only" alt="System components"/>
<img src="/img/diagram-light.png#gh-light-mode-only" alt="System components"/>
</picture>

## Code lifecycle

**Vortex** standardizes the code lifecycle across local, CI, and hosting
environments. This ensures that the same steps are followed everywhere, reducing
the chance of errors and making processes predictable.

<details>
  <summary>Expand to see the complete code lifecycle diagram</summary>

import CodeLifecycle from './_code-lifecycle.mdx';

  <CodeLifecycle />

</details>

## Local development environment

Your project includes a containerized local environment using Docker Compose and
production-grade Lagoon images. This ensures consistency between local, CI, and
hosting environments.

To simplify command usage, we use [Ahoy](https://ahoy-cli.dev/) as a wrapper. It
lets you run complex tasks like provisioning, testing, or database imports
with short, easy-to-remember commands.

:::note Planned features

Support for DDEV and Lando is on our [roadmap](/docs/contributing/roadmap) for local development environments.

:::

## Drupal management

### Provisioning

The provisioning process is central to how **Vortex** works. Instead of manually
running Drush commands, you run a single provision script. This script handles:

- Importing a database or initializing a database by installing Drupal from a profile
- Running updates, config imports, cache rebuilds, and deploy hooks
- Executing post-provision custom scripts

Because provisioning is centralized, it runs exactly in the same way in every
environment: local, CI, or hosting. This eliminates "works on my machine"
problems and makes the process predictable for everyone.

It also allows to add more automation around provisioning, like conditionally
running migrations or creating demo content.

➡️ See [Drupal > Provision](./drupal/provision)

### Module and theme scaffolds

We include examples of a custom module and theme, each fully integrated with
tests. These show you how to:

- Structure custom features
- Write functional, kernel, and unit tests
- Connect theme assets to a build pipeline

Use these scaffolds as starting points for your own work.

➡️ See [Drupal > Module Scaffold](./drupal/module-scaffold)
and [Drupal > Theme Scaffold](./drupal/theme-scaffold)

### Settings management

**Vortex** includes a structured way to manage Drupal settings per environment.
Here's how it works:

- The environment type (e.g. local, CI, stage) is automatically detected based
  on the environment provider settings located in `web/sites/default/includes/providers/`.
- Settings overrides are stored in `web/sites/default/includes/modules/` with logic per
  environment inside each module-specific file.

This structure gives you clarity, avoids config sprawl, and lets you remove a
module’s settings cleanly when no longer needed.

**Vortex** also includes tests for these settings to ensure they are loaded
correctly in each environment.

➡️ See [Drupal > Settings](./drupal/settings)

## Code quality and testing

**Vortex** ships with pre-configured tools for maintaining code quality:

- **PHP CodeSniffer (phpcs)**
- **PHPStan**
- **PHP Mess Detector (phpmd)**
- **Rector**
- **Twig CS Fixer**
- **ESLint**

You’ll also find scaffolds for:

- **PHPUnit**: Unit and kernel testing
- **Behat**: Behavior-driven testing with screenshot capture and extra steps

➡️ See [Tools](./tools)

## Continuous integration workflows

**Vortex** supports GitHub Actions and CircleCI. You choose which one to use in your
project. These pipelines include:

- Database download and caching (for faster builds)
- Full site provisioning in CI
- Running code quality checks
- Running unit, functional and behavior tests
- Triggering deploys when tests pass

Each continuous integration configuration mirrors what happens locally and in hosting to ensure
uniformity.

➡️ See [Continuous Integration](./continuous-integration)

## Hosting integrations

Out of the box, **Vortex** supports Acquia and Lagoon hosting. These integrations:

- Trigger provisioning with the same steps used locally and in CI
- Provide deployment pipelines suited to each platform

You can use **Vortex** with other platforms too, but these are first-class
integrations.

➡️ See [Hosting](./hosting)

## Automated dependency updates

**Vortex** includes configuration for RenovateBot to automate dependency upgrades:

- Critical updates checked daily
- Regular updates run weekly
- PRs include changelogs and pass through your continuous integration pipeline

You can host RenovateBot yourself or use the cloud version, and you can tweak
the schedule as needed.

➡️ See [Tools > Renovate](./tools/renovate)

## Documentation & onboarding

**Vortex** includes centralized documentation (what you're reading now), as well as
a scaffold for adding project-specific docs within your own repository.

## Automation scripts

**Vortex** uses POSIX-compliant Bash scripts in `scripts/vortex` to automate
common tasks and connect components together.

These scripts:

- Run identically across local, CI, and hosting
- Support environment variables to adapt behavior
- Are modular and easy to extend

### Customizing scripts

All scripts support configuration via environment variables, allowing them
to be easily adapted to specific project or environment needs.

During initial project setup, `.env` file is updated with project-specific
values like project name, email etc. Then, environment variables (secrets,
tokens, etc.) are set in CI or hosting environments.

➡️ See [Development > Variables](./development/variables)

### Router scripts

Most **Vortex** commands are implemented as router scripts entry points like
`download-db.sh` or `deploy.sh` that dynamically invoke a more specific logic
for your setup, based on configuration or environment variables.

For example:

- `download-db.sh` is a router script that downloads a database from any
  supported hosting provider or custom location without needing to know the
  specifics of each provider.
- `deploy.sh` is a router script that deploys code to any hosting provider in a
  consistent manner, regardless of whether it's Acquia, Lagoon, or another
  platform.

<details>
<summary>Script architecture diagram</summary>

<picture>
  <img src="/img/diagram-scripts-light.svg#gh-dark-mode-only" alt="Diagram of scripts"/>
  <img src="/img/diagram-scripts-dark.svg#gh-light-mode-only" alt="Diagram of scripts"/>
</picture>

</details>

➡️ See [Variables](./development/variables)

## Environment variables

**Vortex** uses environment variables extensively to configure behavior across
local, CI, and hosting environments.

These variables are either defined in the `.env` file or set within
CI/hosting environments as secrets.

➡️ See [Variables](./development/variables)

## Testing the template

**Vortex** itself is tested at multiple levels to ensure the template and its
automation scripts work correctly:

- **Unit tests**: Shell scripts are tested in isolation using
  [Bats](https://github.com/bats-core/bats-core) with mocked commands
- **End-to-end tests**: Full build pipelines are tested using
  [PHPUnit](https://phpunit.de/) in real Docker containers
- **Real-world validation**: The
  [DrevOps website](https://github.com/drevops/website) serves as a production
  reference site that receives regular upstream updates

➡️ See [Contributing > Maintenance > Tests](./contributing/maintenance/tests)
