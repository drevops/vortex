```mermaid
%%==============================================================================
%% Vortex Code Lifecycle Diagram
%% Naming Convention:
%% - All identifiers use UPPER_SNAKE_CASE with hierarchical prefixes
%%   - Subgraphs: SUBGRAPH_PARENT_CHILD (e.g., SUBGRAPH_CI_BUILD_JOB_ASSEMBLY_PHASE)
%%   - Regular nodes: PARENT_CHILD_NODE, no SUBGRAPH_ prefix (e.g., CI_BUILD_JOB_ASSEMBLY_PHASE_BUILD_DOCKER)
%%==============================================================================

%%{init: {'flowchart': {'curve': 'linear'}}}%%
flowchart TB
    subgraph SUBGRAPH_LOCAL["Local Development"]
        direction LR
        LOCAL_DEV["Developer writes code"]
          --> LOCAL_BUILD_LOCAL["Build and test locally"]
          --> LOCAL_COMMIT["Commit changes"]
    end

    subgraph SUBGRAPH_GIT["Git Repository"]
        direction LR
        GIT_PUSH["Push to remote branch"]
          --> GIT_PR["Open/Update Pull Request"]
    end

    %% CI Pipeline (Outer Box)
    subgraph SUBGRAPH_CI["CI Pipeline"]
        direction TB

        subgraph SUBGRAPH_CI_DATABASE_JOB_NIGHTLY["Database Job (Nightly)"]
            direction LR
            CI_DATABASE_JOB_NIGHTLY_SCHEDULE["Scheduled trigger"]
              --> CI_DATABASE_JOB_NIGHTLY_DB_PROD_DOWNLOAD["Download production<br/>database"]
              --> CI_DATABASE_JOB_NIGHTLY_DB_SANITIZE_NIGHTLY["Sanitize database<br/>Remove sensitive data"]
              --> CI_DATABASE_JOB_NIGHTLY_DB_CACHE_NIGHTLY["Store database cache"]
        end

        subgraph SUBGRAPH_CI_DATABASE_JOB["Database Job"]
            direction LR

            CI_DATABASE_JOB_DB_CACHE_CHECK{"Nightly database<br/>cache exists?"}
            CI_DATABASE_JOB_DB_CACHE_SUCCESS["Pipeline Success"]

            CI_DATABASE_JOB_DB_DOWNLOAD_NEW["Download production<br/>database"]
            CI_DATABASE_JOB_DB_SANITIZE["Sanitize database<br/>Remove sensitive data"]
            CI_DATABASE_JOB_DB_STORE_CACHE["Store database cache"]
        end

        subgraph SUBGRAPH_CI_BUILD_JOB["Build Job"]
            direction TB

            subgraph SUBGRAPH_CI_BUILD_JOB_ASSEMBLY_PHASE["Code assembly"]
                direction LR
                CI_BUILD_JOB_ASSEMBLY_PHASE_BUILD_DOCKER["Build Docker<br/>image"]
                  --> CI_BUILD_JOB_ASSEMBLY_PHASE_COMPOSER["Install<br/>Composer deps"]
                  --> CI_BUILD_JOB_ASSEMBLY_PHASE_NPM["Install<br/>NPM deps"]
                  --> CI_BUILD_JOB_ASSEMBLY_PHASE_BUILD_ASSETS["Build front-end<br/>assets"]
            end

            subgraph SUBGRAPH_CI_BUILD_JOB_PROVISION_PHASE["Website setup"]
                direction LR
                CI_BUILD_JOB_PROVISION_PHASE_DB_DOWNLOAD["Import cached<br/>database"]
                    --> CI_BUILD_JOB_PROVISION_PHASE_PROVISION_OPS_PROV_DEPLOY["<b>Run <code>drush deploy</code></b>"]
                    --> CI_BUILD_JOB_PROVISION_PHASE_PROVISION_OPS_PROV_CUSTOM["<b>Run custom<br/>scripts</b>"]
            end

            subgraph SUBGRAPH_CI_BUILD_JOB_TEST_PHASE["Testing"]
                direction LR
                  CI_BUILD_JOB_TEST_PHASE_COMPOSER_CHECK["<b>Composer checks</b><br/>Check lock<br/>Audit dependencies"]
                  --> CI_BUILD_JOB_TEST_PHASE_LINT["<b>Coding standards</b><br/>PHPCS, PHPStan, Rector, PHPMD, ESLint, Twig CS Fixer"]
                  --> CI_BUILD_JOB_TEST_PHASE_UNIT["<b>PHPUnit<br/>tests</b>"]
                  --> CI_BUILD_JOB_TEST_PHASE_BEHAT["<b>Behat<br/>tests</b>"]
            end
        end

        subgraph SUBGRAPH_CI_DEPLOYMENT_JOB["Deployment Job"]
            direction LR
            CI_DEPLOYMENT_JOB_WEBHOOK["<b>Webhook</b><br/>Call webhook URL"]
              ~~~ CI_DEPLOYMENT_JOB_ARTIFACT["<b>Artifact</b><br/>Package Git artifact"]
              ~~~ CI_DEPLOYMENT_JOB_LAGOON["<b>Lagoon</b><br/>Call Lagoon webhook"]
              ~~~ CI_DEPLOYMENT_JOB_DOCKER["<b>Docker</b><br/>Create container image"]
        end
    end

    subgraph SUBGRAPH_HOSTING["Hosting Platform"]
        direction LR

        HOSTING_ENV_DECISION{"Environment<br/>exists?"}
        HOSTING_NEW_DB_SYNC["Sync database<br/>from production"]

        HOSTING_PROVISION_OPS_PROV_DEPLOY["<b>Run <code>drush deploy</code></b>"]
        --> HOSTING_PROVISION_OPS_PROV_CUSTOM["<b>Run custom<br/>scripts</b>"]
        --> HOSTING_SEND_NOTIFICATIONS["<b>Send notifications</b><br/>Email, Slack, NewRelic"]
    end

    subgraph SUBGRAPH_ENVIRONMENTS["Available Environments"]
        direction LR
        ENVIRONMENTS_PR_ENV["<b>PR Environment</b><br/>Auto-removed"]
          ~~~ ENVIRONMENTS_DEV_ENV["<b>Dev</b><br/><code>develop</code> branch"]
          ~~~ ENVIRONMENTS_STAGE_ENV["<b>Staging</b><br/><code>main</code> branch"]
          ~~~ ENVIRONMENTS_PROD_ENV["<b>Production</b><br/><code>production</code> branch or tag"]
    end

    %% Main Flow - Only OUTER Box to OUTER Box Connections
    SUBGRAPH_LOCAL --> SUBGRAPH_GIT
    SUBGRAPH_GIT --> SUBGRAPH_CI
    SUBGRAPH_CI --> SUBGRAPH_HOSTING
    SUBGRAPH_HOSTING --> SUBGRAPH_ENVIRONMENTS

    %% Internal flows within CI Pipeline
    SUBGRAPH_CI_DATABASE_JOB_NIGHTLY -.->|Provides cached<br/>database| SUBGRAPH_CI_DATABASE_JOB

    %% Database Job internal flow
    CI_DATABASE_JOB_DB_CACHE_CHECK -->|Yes| CI_DATABASE_JOB_DB_CACHE_SUCCESS
    CI_DATABASE_JOB_DB_CACHE_CHECK -->|No| CI_DATABASE_JOB_DB_DOWNLOAD_NEW
    CI_DATABASE_JOB_DB_DOWNLOAD_NEW --> CI_DATABASE_JOB_DB_SANITIZE

    CI_DATABASE_JOB_DB_SANITIZE --> CI_DATABASE_JOB_DB_STORE_CACHE

    SUBGRAPH_CI_DATABASE_JOB --> SUBGRAPH_CI_BUILD_JOB
    SUBGRAPH_CI_BUILD_JOB_ASSEMBLY_PHASE --> SUBGRAPH_CI_BUILD_JOB_PROVISION_PHASE
    SUBGRAPH_CI_BUILD_JOB_PROVISION_PHASE --> SUBGRAPH_CI_BUILD_JOB_TEST_PHASE
    SUBGRAPH_CI_BUILD_JOB --> SUBGRAPH_CI_DEPLOYMENT_JOB

    %% Internal flows within Hosting Platform
    HOSTING_ENV_DECISION -->|No| HOSTING_NEW_DB_SYNC
    HOSTING_NEW_DB_SYNC --> HOSTING_PROVISION_OPS_PROV_DEPLOY
    HOSTING_ENV_DECISION -.->|Yes| HOSTING_PROVISION_OPS_PROV_DEPLOY
```

<style>{`

/* ============================================================================
 * Light Theme – Eraser-style color system
 * ============================================================================ */

/* ---------- Local Development (blue family) ---------- */
#SUBGRAPH_LOCAL > rect {
  fill: #B3D7F2 !important;
  stroke: #5BA6D1 !important;
}
#LOCAL_DEV > rect,
#LOCAL_BUILD_LOCAL > rect,
#LOCAL_COMMIT > rect {
  fill: #E7F4FC !important;
  stroke: #5BA6D1 !important;
}

/* ---------- Git Repository (purple family) ---------- */
#SUBGRAPH_GIT > rect {
  fill: #D7C4EB !important;
  stroke: #A47BD3 !important;
}
#GIT_PUSH > rect,
#GIT_PR > rect {
  fill: #F2EAFE !important;
  stroke: #A47BD3 !important;
}

/* ---------- CI Pipeline container (warm gray) ---------- */
#SUBGRAPH_CI > rect {
  fill: #EAE7DF !important;
  stroke: #C7C2B5 !important;
}

/* ---------- Database Job (Nightly – olive family) ---------- */
#SUBGRAPH_CI_DATABASE_JOB_NIGHTLY > rect {
  fill: #DCE8C5 !important;
  stroke: #9CB870 !important;
}
#CI_DATABASE_JOB_NIGHTLY_SCHEDULE > rect,
#CI_DATABASE_JOB_NIGHTLY_DB_PROD_DOWNLOAD > rect,
#CI_DATABASE_JOB_NIGHTLY_DB_SANITIZE_NIGHTLY > rect,
#CI_DATABASE_JOB_NIGHTLY_DB_CACHE_NIGHTLY > rect {
  fill: #F2F7E8 !important;
  stroke: #9CB870 !important;
}
/* Nightly cache highlight */
#CI_DATABASE_JOB_NIGHTLY_DB_CACHE_NIGHTLY > rect {
  fill: #C39BD3 !important;
}
#CI_DATABASE_JOB_NIGHTLY_DB_CACHE_NIGHTLY text {
  fill: #FFFFFF !important;
}

/* ---------- Database Job (Main – brown family) ---------- */
#SUBGRAPH_CI_DATABASE_JOB > rect {
  fill: #E7D8C7 !important;
  stroke: #C29B72 !important;
}
#CI_DATABASE_JOB_DB_DOWNLOAD_NEW > rect,
#CI_DATABASE_JOB_DB_SANITIZE > rect,
#CI_DATABASE_JOB_DB_STORE_CACHE > rect {
  fill: #F7EFE6 !important;
  stroke: #C29B72 !important;
}

/* Database cache decision diamond */
#CI_DATABASE_JOB_DB_CACHE_CHECK > path {
  fill: #FFB74D !important;
  stroke: #FB8C00 !important;
}

/* ---------- Build Job (navy/blue family) ---------- */
#SUBGRAPH_CI_BUILD_JOB > rect {
  fill: #C6D6EA !important;
  stroke: #7FA5C8 !important;
}

/* Assembly Phase (mint tint) */
#SUBGRAPH_CI_BUILD_JOB_ASSEMBLY_PHASE > rect {
  fill: #D9F4E3 !important;
  stroke: #7FA5C8 !important;
}
#CI_BUILD_JOB_ASSEMBLY_PHASE_BUILD_DOCKER > rect,
#CI_BUILD_JOB_ASSEMBLY_PHASE_COMPOSER > rect,
#CI_BUILD_JOB_ASSEMBLY_PHASE_NPM > rect,
#CI_BUILD_JOB_ASSEMBLY_PHASE_BUILD_ASSETS > rect {
  fill: #EDF7F1 !important;
  stroke: #7FA5C8 !important;
}

/* ---------- Provision Phase ---------- */
#SUBGRAPH_CI_BUILD_JOB_PROVISION_PHASE > rect {
  fill: #DCE3F2 !important;
  stroke: #9CB1D7 !important;
}

#CI_BUILD_JOB_PROVISION_PHASE_DB_DOWNLOAD > rect,
#CI_BUILD_JOB_PROVISION_PHASE_PROVISION_OPS_PROV_DEPLOY > rect,
#CI_BUILD_JOB_PROVISION_PHASE_PROVISION_OPS_PROV_CUSTOM > rect,
#HOSTING_PROVISION_OPS_PROV_DEPLOY > rect,
#HOSTING_PROVISION_OPS_PROV_CUSTOM > rect {
  fill: #F4F7FD !important;
  stroke: #9CB1D7 !important;
}

/* ---------- Testing Phase (gold family) ---------- */
#SUBGRAPH_CI_BUILD_JOB_TEST_PHASE > rect {
  fill: #F3E9C7 !important;
  stroke: #D2B462 !important;
}
#CI_BUILD_JOB_TEST_PHASE_LINT > rect,
#CI_BUILD_JOB_TEST_PHASE_COMPOSER_CHECK > rect,
#CI_BUILD_JOB_TEST_PHASE_UNIT > rect,
#CI_BUILD_JOB_TEST_PHASE_BEHAT > rect {
  fill: #FCF7E6 !important;
  stroke: #D2B462 !important;
}

/* ---------- Deployment Job (lavender family) ---------- */
#SUBGRAPH_CI_DEPLOYMENT_JOB > rect {
  fill: #E3DDF5 !important;
  stroke: #AA99E2 !important;
}
#CI_DEPLOYMENT_JOB_WEBHOOK > rect,
#CI_DEPLOYMENT_JOB_ARTIFACT > rect,
#CI_DEPLOYMENT_JOB_LAGOON > rect,
#CI_DEPLOYMENT_JOB_DOCKER > rect {
  fill: #F5F2FC !important;
  stroke: #AA99E2 !important;
}

/* ---------- Hosting Platform (rose family) ---------- */
#SUBGRAPH_HOSTING > rect {
  fill: #F6DDE3 !important;
  stroke: #D79AA5 !important;
}
#HOSTING_NEW_DB_SYNC > rect,
#HOSTING_SEND_NOTIFICATIONS > rect {
  fill: #FDF1F4 !important;
  stroke: #D79AA5 !important;
}

/* Hosting environment decision diamond */
#HOSTING_ENV_DECISION > path {
  fill: #FFB74D !important;
  stroke: #FB8C00 !important;
}

/* ---------- Available Environments (sage family) ---------- */
#SUBGRAPH_ENVIRONMENTS > rect {
  fill: #D7E8D7 !important;
  stroke: #8FB48F !important;
}

[id^="flowchart-ENVIRONMENTS_PR_ENV"] > rect {
  stroke-dasharray: 10 5;
}

#ENVIRONMENTS_PR_ENV > rect,
#ENVIRONMENTS_DEV_ENV > rect,
#ENVIRONMENTS_STAGE_ENV > rect,
#ENVIRONMENTS_PROD_ENV > rect {
  fill: #F1F8F1 !important;
  stroke: #8FB48F !important;
}

/* ---------- Success nodes ---------- */
#CI_DATABASE_JOB_DB_CACHE_SUCCESS > rect {
  fill: #4CAF50 !important;
  stroke: #388E3C !important;
}
#CI_DATABASE_JOB_DB_CACHE_SUCCESS text {
  fill: #FFFFFF !important;
}

/* ---------- Fallback for any remaining nodes ---------- */
.node rect {
  fill: #F7F7F7 !important;
  stroke-width: 1px;
}

/* ============================================================================
 * DARK THEME — Eraser-style color system
 * ============================================================================ */

/* -------------------------------------------
   Local Development (blue family – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_LOCAL > rect {
  fill: #1C2E3A !important;
  stroke: #4BA3D6 !important;
}
[data-theme="dark"] #LOCAL_DEV > rect,
[data-theme="dark"] #LOCAL_BUILD_LOCAL > rect,
[data-theme="dark"] #LOCAL_COMMIT > rect {
  fill: #243B4A !important;
  stroke: #4BA3D6 !important;
}

/* -------------------------------------------
   Git Repository (purple family – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_GIT > rect {
  fill: #2A1C32 !important;
  stroke: #B084D6 !important;
}
[data-theme="dark"] #GIT_PUSH > rect,
[data-theme="dark"] #GIT_PR > rect {
  fill: #332040 !important;
  stroke: #B084D6 !important;
}

/* -------------------------------------------
   CI Pipeline (warm gray – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_CI > rect {
  fill: #2A2926 !important;
  stroke: #A29D91 !important;
}

/* -------------------------------------------
   Database Job (Nightly – olive family)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_CI_DATABASE_JOB_NIGHTLY > rect {
  fill: #2E341F !important;
  stroke: #A5C36E !important;
}
[data-theme="dark"] #CI_DATABASE_JOB_NIGHTLY_SCHEDULE > rect,
[data-theme="dark"] #CI_DATABASE_JOB_NIGHTLY_DB_PROD_DOWNLOAD > rect,
[data-theme="dark"] #CI_DATABASE_JOB_NIGHTLY_DB_SANITIZE_NIGHTLY > rect {
  fill: #3A4224 !important;
  stroke: #A5C36E !important;
}
/* Nightly cache highlight */
[data-theme="dark"] #CI_DATABASE_JOB_NIGHTLY_DB_CACHE_NIGHTLY > rect {
  fill: #8E67A6 !important;
  stroke: #CBA7E8 !important;
}
[data-theme="dark"] #CI_DATABASE_JOB_NIGHTLY_DB_CACHE_NIGHTLY text {
  fill: #FFFFFF !important;
}

/* -------------------------------------------
   Database Job (Main – brown family)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_CI_DATABASE_JOB > rect {
  fill: #3A2E26 !important;
  stroke: #B88955 !important;
}
[data-theme="dark"] #CI_DATABASE_JOB_DB_DOWNLOAD_NEW > rect,
[data-theme="dark"] #CI_DATABASE_JOB_DB_SANITIZE > rect,
[data-theme="dark"] #CI_DATABASE_JOB_DB_STORE_CACHE > rect {
  fill: #47392F !important;
  stroke: #B88955 !important;
}

/* DB decision diamond */
[data-theme="dark"] #CI_DATABASE_JOB_DB_CACHE_CHECK > path {
  fill: #C77D31 !important;
  stroke: #E0913A !important;
}

/* -------------------------------------------
   Build Job (navy/blue family – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_CI_BUILD_JOB > rect {
  fill: #1C2533 !important;
  stroke: #7AA4C5 !important;
}

/* Assembly Phase */
[data-theme="dark"] #SUBGRAPH_CI_BUILD_JOB_ASSEMBLY_PHASE > rect {
  fill: #233140 !important;
  stroke: #7AA4C5 !important;
}
[data-theme="dark"] #CI_BUILD_JOB_ASSEMBLY_PHASE_BUILD_DOCKER > rect,
[data-theme="dark"] #CI_BUILD_JOB_ASSEMBLY_PHASE_COMPOSER > rect,
[data-theme="dark"] #CI_BUILD_JOB_ASSEMBLY_PHASE_NPM > rect,
[data-theme="dark"] #CI_BUILD_JOB_ASSEMBLY_PHASE_BUILD_ASSETS > rect {
  fill: #2A3A4A !important;
  stroke: #7AA4C5 !important;
}

/* -------------------------------------------
   Provision Phase
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_CI_BUILD_JOB_PROVISION_PHASE > rect {
  fill: #1F2738 !important;
  stroke: #8CA3CF !important;
}

[data-theme="dark"] #CI_BUILD_JOB_PROVISION_PHASE_DB_DOWNLOAD > rect,
[data-theme="dark"] #CI_BUILD_JOB_PROVISION_PHASE_PROVISION_OPS_PROV_DEPLOY > rect,
[data-theme="dark"] #CI_BUILD_JOB_PROVISION_PHASE_PROVISION_OPS_PROV_CUSTOM > rect,
[data-theme="dark"] #HOSTING_PROVISION_OPS_PROV_DEPLOY > rect,
[data-theme="dark"] #HOSTING_PROVISION_OPS_PROV_CUSTOM > rect {
  fill: #262F41 !important;
  stroke: #8CA3CF !important;
}

/* -------------------------------------------
   Testing Phase (gold family – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_CI_BUILD_JOB_TEST_PHASE > rect {
  fill: #3D351E !important;
  stroke: #C5A554 !important;
}
[data-theme="dark"] #CI_BUILD_JOB_TEST_PHASE_LINT > rect,
[data-theme="dark"] #CI_BUILD_JOB_TEST_PHASE_COMPOSER_CHECK > rect,
[data-theme="dark"] #CI_BUILD_JOB_TEST_PHASE_UNIT > rect,
[data-theme="dark"] #CI_BUILD_JOB_TEST_PHASE_BEHAT > rect {
  fill: #473F24 !important;
  stroke: #C5A554 !important;
}

/* -------------------------------------------
   Deployment Job (lavender family – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_CI_DEPLOYMENT_JOB > rect {
  fill: #2D263A !important;
  stroke: #9C8AD4 !important;
}
[data-theme="dark"] #CI_DEPLOYMENT_JOB_WEBHOOK > rect,
[data-theme="dark"] #CI_DEPLOYMENT_JOB_ARTIFACT > rect,
[data-theme="dark"] #CI_DEPLOYMENT_JOB_LAGOON > rect,
[data-theme="dark"] #CI_DEPLOYMENT_JOB_DOCKER > rect {
  fill: #362E47 !important;
  stroke: #9C8AD4 !important;
}

/* -------------------------------------------
   Hosting Platform (rose family – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_HOSTING > rect {
  fill: #3A232A !important;
  stroke: #D48A98 !important;
}
[data-theme="dark"] #HOSTING_NEW_DB_SYNC > rect,
[data-theme="dark"] #HOSTING_SEND_NOTIFICATIONS > rect {
  fill: #452B32 !important;
  stroke: #D48A98 !important;
}

/* Hosting decision diamond */
[data-theme="dark"] #HOSTING_ENV_DECISION > path {
  fill: #C77D31 !important;
  stroke: #E0913A !important;
}

/* -------------------------------------------
   Environments (sage family – dark)
-------------------------------------------- */
[data-theme="dark"] #SUBGRAPH_ENVIRONMENTS > rect {
  fill: #273328 !important;
  stroke: #7BAA7B !important;
}
[data-theme="dark"] #ENVIRONMENTS_PR_ENV > rect,
[data-theme="dark"] #ENVIRONMENTS_DEV_ENV > rect,
[data-theme="dark"] #ENVIRONMENTS_STAGE_ENV > rect,
[data-theme="dark"] #ENVIRONMENTS_PROD_ENV > rect {
  fill: #2F3E31 !important;
  stroke: #7BAA7B !important;
}

/* -------------------------------------------
   Success nodes
-------------------------------------------- */
[data-theme="dark"] #CI_DATABASE_JOB_DB_CACHE_SUCCESS > rect {
  fill: #2E7D32 !important;
  stroke: #1B5E20 !important;
}
[data-theme="dark"] #CI_DATABASE_JOB_DB_CACHE_SUCCESS text {
  fill: #FFFFFF !important;
}

/* -------------------------------------------
   Generic node fallback
-------------------------------------------- */
[data-theme="dark"] .node rect {
  fill: #383838 !important;
  stroke: #555 !important;
  stroke-width: 1px;
}

`}</style>
