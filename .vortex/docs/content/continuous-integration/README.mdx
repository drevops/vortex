---
sidebar_label: Overview
sidebar_position: 1
---

# Continuous Integration

**Vortex** offers continuous integration configurations for [GitHub Actions](/docs/continuous-integration/github-actions)
and [CircleCI](/docs/continuous-integration/circleci) providers that allow you to
automate the process of building, testing, and deploying your site.

The workflow configuration is identical for both continuous integration
providers. You would need to choose one of them and follow the setup
instructions.

The continuous integration pipeline consists of multiple jobs executed in a
containerized environment to ensure consistency across runs.

## Trigger conditions

The continuous integration pipeline is triggered by:

- **Push events** to the following branches:
  - `production`,
  - `main`,
  - `master`,
  - `develop`
  - `release/**`,
  - `hotfix/**`,
  - `project/**`
- **Pull requests** to these branches
- **Scheduled runs** for automatic database caching

## Workflow structure

<details>
<summary>Expand to see the complete code lifecycle diagram</summary>

import CodeLifecycle from '../workflows/_code-lifecycle.mdx';

<CodeLifecycle />

</details>

### 1. Database

- Runs in a [`drevops/ci-runner`](https://github.com/drevops/ci-runner) _runner_ container
- Downloads the latest DB version based on a caching strategy
- Caches database dumps to speed up the follow-up runs

### 2. Build

- Runs after the `database` job
- Uses Docker Compose to set up the environment
- Validates Composer lock and audits dependencies
- Assembles the codebase by installing dependencies
- Provisions a website
- Lints code (only on the first instance)
- Runs unit tests
- Runs BDD tests
- Generates code coverage reports
- Collects and stores test results and artifacts

### 3. Deployment

- Runs after successful completion of a previous `build` job
- Uses the built codebase without development dependencies from the `build` step
- Adds required secrets and environment variables
- Triggers a deployment using a router script

## Caching strategy

Database is downloaded overnight and cached so that the next continuous integration run on the same
day uses the cached database dump.

By default, the database is cached per-branch for 24 hours. If cache is not
available, the fallback default branch is used.

:::note

Database caching is a very powerful feature that allows to speed up the
continuous integration runs on large projects with a lot of data.

In case of a project with a large database >1GB, the database import itself may
take a long time, so it may be worth looking into either packaging the database
dump into a container image (overnight) or using a sanitized database dump with
only the required data for the tests.

**Vortex** supports both creating and using a database container image with embedded
data. You may use [MariaDB data container for Drupal with database captured as Docker layers](https://github.com/drevops/mariadb-drupal-data) to create
an initial database image.

There are other tools also available for this purpose, such as [Drush GDPR Dumper](https://github.com/robiningelbrecht/drush-gdpr-dumper)
that allows to remove data from the database dump during Drush database
export command without the need for an intermediate database import step.

:::

## Maintenance

### Enable debug mode

To get verbose output when troubleshooting build failures, enable debug mode
by setting the `VORTEX_DEBUG` variable to `1` in your CI provider's settings.

### Update CI runner image

The CI jobs run inside the [`drevops/ci-runner`](https://github.com/drevops/ci-runner)
container - a Docker image specifically designed for CI job execution. It
provides a consistent, reproducible environment with 25+ pre-installed tools:

- **PHP & Node.js** - PHP 8.4, Node.js, Composer, npm, Yarn
- **Docker tools** - Docker, Docker Compose, Docker Buildx
- **Code quality** - ShellCheck, shfmt, Bats testing framework
- **Utilities** - Git, curl, rsync, jq, and more

Using this image ensures all CI runs have identical tooling, eliminating
environment inconsistencies between local development and CI.

To update to a newer version, change the image tag in your CI configuration
file. The image follows Year-Month-Patch versioning (e.g., `25.10.0`) with
monthly releases.

### Skip specific linters

During development, you may want to allow builds to pass despite linter failures.
Set the corresponding `*_IGNORE_FAILURE` variable to `1`:

| Variable | Tool |
|----------|------|
| `VORTEX_CI_PHPCS_IGNORE_FAILURE` | PHPCS |
| `VORTEX_CI_PHPSTAN_IGNORE_FAILURE` | PHPStan |
| `VORTEX_CI_RECTOR_IGNORE_FAILURE` | Rector |
| `VORTEX_CI_PHPMD_IGNORE_FAILURE` | PHPMD |
| `VORTEX_CI_PHPUNIT_IGNORE_FAILURE` | PHPUnit |
| `VORTEX_CI_BEHAT_IGNORE_FAILURE` | Behat |

### Configure deployment skip conditions

To skip deployments for specific branches, set the `VORTEX_DEPLOY_SKIP_BRANCHES`
variable to a comma-separated list of branch patterns:

```bash
VORTEX_DEPLOY_SKIP_BRANCHES="feature/*,experimental/*"
```
