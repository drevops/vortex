@@ -15,6 +15,7 @@
 # ------------------------------------------------------------------------------
 
 # Environment variables set in all containers during build and runtime.
+# Note that these variables are not read from here in Lagoon environment.
 x-environment: &default-environment
   TZ: ${TZ:-UTC}
   # Pass-through 'CI' variable used to identify the CI environment.
@@ -54,6 +55,16 @@
   DRUPAL_SHIELD_PASS: ${DRUPAL_SHIELD_PASS:-}
   # Redis integration flag.
   DRUPAL_REDIS_ENABLED: ${DRUPAL_REDIS_ENABLED:-}
+  # Local migration database host (not used in production).
+  DATABASE2_HOST: database2
+  # Local migration database name (not used in production).
+  DATABASE2_NAME: drupal
+  # Local migration database user (not used in production).
+  DATABASE2_USERNAME: drupal
+  # Local migration database password (not used in production).
+  DATABASE2_PASSWORD: drupal
+  # Local migration database port (not used in production).
+  DATABASE2_PORT: 3306
 
 # The default user under which the containers should run.
 x-user: &default-user
@@ -103,6 +114,10 @@
       wait-for-dependencies:
         condition: service_completed_successfully
     user: root
+    labels:
+      lagoon.type: cli-persistent # See https://docs.lagoon.sh/using-lagoon-advanced/service-types/
+      lagoon.persistent.name: &lagoon-nginx-name nginx-php # Mount the persistent storage of nginx-php pod into this container.
+      lagoon.persistent: &lagoon-persistent-files /app/web/sites/default/files/  # Location where the persistent storage should be mounted.
 
   nginx:
     build:
@@ -121,6 +136,11 @@
     networks:
       - default # This is a standard network and is used for all other environments, where requests routing is not required and/or not supported.
       - amazeeio-network ### This network is supported by Pygmy and used to route all requests to host machine locally. Removed in CI.
+    labels:
+      lagoon.type: nginx-php-persistent # See https://docs.lagoon.sh/using-lagoon-advanced/service-types/
+      lagoon.name: *lagoon-nginx-name
+      lagoon.persistent: *lagoon-persistent-files
+      lagoon.persistent.class: slow
 
   # PHP FPM container. All web requests are going through this container.
   php:
@@ -136,6 +156,11 @@
     <<: [ *default-volumes, *default-user ]
     depends_on:
       - cli
+    labels:
+      lagoon.type: nginx-php-persistent # See https://docs.lagoon.sh/using-lagoon-advanced/service-types/
+      lagoon.name: *lagoon-nginx-name
+      lagoon.persistent: *lagoon-persistent-files
+      lagoon.persistent.class: slow
 
   database:
     build:
@@ -148,9 +173,26 @@
     <<: *default-user
     ports:
       - '3306' # Database port in a container. Find port on host with `ahoy info` or `docker compose port database 3306`.
+    labels:
+      lagoon.type: mariadb # See https://docs.lagoon.sh/using-lagoon-advanced/service-types/
 
+  database2:
+    image: uselagoon/mysql-8.4:__VERSION__
+    environment:
+      <<: *default-environment
+      MYSQL_DATABASE: drupal
+      MYSQL_USER: drupal
+      MYSQL_PASSWORD: drupal
+    <<: *default-user
+    ports:
+      - '3306'
+    labels:
+      lagoon.type: none
+
   redis:
     image: uselagoon/valkey-8:__VERSION__
+    labels:
+      lagoon.type: redis # Change to 'none' if dedicated Redis service is used. See https://docs.lagoon.sh/using-lagoon-advanced/service-types/
 
   solr:
     build:
@@ -162,6 +204,8 @@
       - solr:/var/solr
     ports:
       - '8983' # Solr port in a container. Find port on host with `ahoy info` or `docker compose port solr 8983`.
+    labels:
+      lagoon.type: solr # See https://docs.lagoon.sh/using-lagoon-advanced/service-types/
 
   clamav:
     build:
@@ -173,6 +217,10 @@
       - '3310' # Find port on host with `docker compose port clamav 3310`.
     networks:
       - default
+    labels:
+      lagoon.type: basic
+      lagoon.service.port: 3310 # See https://docs.lagoon.sh/using-lagoon-advanced/service-types/
+      lagoon.autogeneratedroute: false
 
   # Chrome container, used for browser testing.
   chrome:
@@ -185,6 +233,8 @@
     ports:
       - '7900' # Find port on host with `docker compose port chrome 7900`.
     shm_size: '1gb' # Increase '/dev/shm' partition size to avoid browser crashing.
+    labels:
+      lagoon.type: none # Do not deploy in Lagoon.
 
   # Helper container to wait for services to become available.
   wait-for-dependencies:
@@ -192,14 +242,18 @@
     depends_on:
       - clamav
       - database
+      - database2
       - redis
       - solr
     command:
       - clamav:3310
       - database:3306
+      - database2:3306
       - redis:6379
       - solr:8983
       - curl -s "http://solr:8983/solr/drupal/select?q=*:*&rows=0&wt=json" | grep response
+    labels:
+      lagoon.type: none # Do not deploy in Lagoon.
 
 networks:           ### Use external networks locally. Automatically removed in CI.
   amazeeio-network: ### Automatically removed in CI.
